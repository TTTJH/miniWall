<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <link href="https://cdn.bootcdn.net/ajax/libs/Swiper/8.0.6/swiper-bundle.css" rel="stylesheet">
    <style>
/* #dff6f0;
32dbc6 */
        html,
        body {
            height: 100%;
            overflow-x: hidden;
        }

        * {
            margin: 0;
            padding: 0;
        }

        *::selection {
            background: #36b5b0;
            color: #ffffff;
        }

        *::-moz-selection {
            background: #36b5b0;
            color: #ffffff;
        }

        *::-webkit-selection {
            background: #36b5b0;
            color: #ffffff;
        }


        .show {
            display: inline-block;
        }

        .hidden {
            display: none;
        }

        .content {
            /* width: 1620px; */
            margin: 0px auto;
            box-sizing: border-box;
            padding: 0px 10px;
            height: 100%;
            position: relative;
        }

        /* 
        .box {

            margin-top: 1rem;
            display: inline-block;
        } */

        .card {
            width: 250px;
            /* width: 14vw; */
            position: absolute;
            min-height: 200px;
            overflow: hidden;
            display: inline-block;
            /* margin: 15px; */
            /* margin: 0px auto; */
            border-radius: 10px;
            border: 1px solid #f0f0f0;
            box-shadow: 5px 5px 30px #f0f0f0;
            transition-duration: 1s;
            background-color: #dff6f0;
        }

        .card:hover {
            box-shadow: 5px 5px 50px #e5dfdf;
            ;
        }

        .addBtn-box {
            z-index: 10;

            width: 40px;
            height: 40px;
            border: 2px solid;
            position: fixed;
            right: 30px;
            bottom: 30px;
            padding: 15px;
            cursor: pointer;
            border-radius: 50%;
            /* background-color: yellow; */
            background-color: #dff6f0;
            overflow: hidden;
        }

        .addBtn {
            width: inherit;
            height: inherit;
        }

        .addBtnBoxAni {
            animation-name: addBtn;
            animation-duration: 0.3s;
        }

        .edit-box {
            width: 30vw;
            height: 100%;
            padding-top: 2rem;
            box-sizing: border-box;
            position: fixed;
            right: 0;
            text-align: center;
            box-shadow: -5px -5px 30px #f0f0f0;
            background-color: #dff6f0;
            display: none;
            overflow: hidden;
            z-index: 10;
            /* animation-name: edit-box;
            animation-duration: 0.5s;
            animation-timing-function: linear;
            animation-fill-mode: forwards; */
        }

        .edit-box input {
            width: 70%;
            height: 40px;
            border-radius: 10px;
            outline: none;
            border: none;
            padding: 0px 10px;
            color: #69606b;
            text-align: center;
            margin: 1.5rem 0;
            font-size: 20px;
            /* box-shadow: 1px 1px 10px #f0f0f0, 0px 2px 10px #f0f0f0 inset; */
            box-shadow: 1px 1px 10px #f0f0f0;
        }

        .edit-box textarea {
            width: 70%;
            max-height: 70vh;
            border-radius: 10px;
            outline: none;
            border: none;
            padding: 10px;
            color: #69606b;
            font-size: 20px;
            /* box-shadow: 1px 1px 10px #f0f0f0, 0px 2px 10px #f0f0f0 inset; */
            box-shadow: 1px 1px 10px #f0f0f0;
            height: 60vh;
            resize: none;
        }

        .edit-box .edit-btn-box {
            width: 75%;
            /* height: 80px; */
            margin: 20px auto;
        }

        .edit-btn-box .edit-confirm-btn,
        .edit-btn-box .edit-cancel-btn {
            display: inline-block;
            width: 48%;
            height: 50px;
            cursor: pointer;
            box-shadow: 5px 5px 30px #f0f0f0;
            text-align: center;
            line-height: 50px;
            font-size: 20px;
            color: white;
            background-color: white;
        }

        .edit-btn-box .edit-confirm-btn {
            margin-left: 3px;
            border-top-left-radius: 40px;
            border-bottom-left-radius: 40px;
            background-color: #36b5b0;
        }

        .edit-btn-box .edit-cancel-btn {
            margin-left: 3px;
            background-color: #ef4339;
            border-top-right-radius: 40px;
            border-bottom-right-radius: 40px;
        }


        .card-icon {
            display: inline-block;
            width: 65px;
            height: 65px;
            margin: 10px 20px;
            /* border-radius: 50%; */
            /* border: 1px solid #f0f0f0; */
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
        }

        .edit-icon {
            display: inline-block;
            width: 65px;
            height: 65px;
            /* border-radius: 50%; */
            /* border: 1px solid gray; */
            margin-top: 0.5rem;
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
        }

        .playerName {
            vertical-align: middle;
            font-size: 20px;
            color: #69606b;
        }

        .card-content {
            width: 100%;
            min-height: inherit;
            border-radius: 10px;
            padding: 10px 15px;
            line-height: 1.7rem;
            font-size: 1.2rem;
            box-sizing: border-box;
            color: #393e46;
        }

        .swiper-container1 {
            /* width: 75%;
            height: 300px; */
        }

        .swiper-container2 {
            /* display: none; */
        }

        /* .swiper-container1 img,
        .swiper-container2 img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        } */
        .icon-border {
            width: 80px;
            height: 80px;
            margin: 0px auto;
            border: 1px solid #f0f0f0;
            border-radius: 50%;
        }

        .success-alert {
            z-index: 10;
            width: 250px;
            height: 65px;
            line-height: 65px;
            text-align: center;
            border-radius: 10px;
            position: absolute;
            left: 50%;
            margin-left: -125px;
            top: 20px;
            box-shadow: 0px 0px 20px #e5dfdf;
            letter-spacing: 2px;
            background-color: #ffffff;
            display: none;
        }

        .error-alert {
            z-index: 10;
            /* width: 250px; */
            display: inline-block;
            padding: 0 10px;
            height: 65px;
            line-height: 65px;
            text-align: center;
            border-radius: 10px;
            position: absolute;
            left: 50%;
            margin-left: -125px;
            top: 20px;
            box-shadow: 0px 0px 20px #e5dfdf;
            letter-spacing: 2px;
            background-color: #ffffff;
            color: #ef4339;
            display: none;
        }




        @keyframes addBtn {
            0% {
                transform: scale(1);
            }

            10% {
                transform: scale(1.05);
            }

            20% {
                transform: scale(1.1);
            }

            30% {
                transform: scale(1.15);
            }

            40% {
                transform: scale(1.2);
            }

            50% {
                transform: scale(1.25);
            }

            60% {
                transform: scale(1.2);
            }

            70% {
                transform: scale(1.15);
            }

            80% {
                transform: scale(1.1);
            }

            90% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes edit-box {
            0% {
                width: 0vw;
            }

            100% {
                width: 30vw;
            }

        }

        /* 一张卡片相当于270px */


        @media only screen and (min-width:1370px) and (max-width:1620px) {
            /* 采用五张卡片的情况开始 */

        }

        @media only screen and (min-width:1110px) and (max-width:1369px) {
            /* 采用四张卡片的情况 */

        }

        @media only screen and (min-width:830px) and (max-width:1109px) {
            /* 采用三张卡片的情况 */

        }

        @media only screen and (min-width:565px) and (max-width:829px) {
            /* 采用2张卡片的情况 */

        }

        @media only screen and (max-width:564px) {

            /* 采用1张卡片的情况 */
            .addBtn-box {
                bottom: 15px;
                right: 15px;
            }

            .edit-box {
                width: 100vw;
            }

            .edit-box textarea {
                max-height: 50vh;
            }

            .edit-box .edit-btn-box {
                margin: 10px auto;
            }

            .edit-btn-box .edit-confirm-btn{
                margin: unset;
            }
        }
    </style>
</head>

<body>
    <div class="addBtn-box">
        <svg class="addBtn" aria-hidden="true">
            <use xlink:href="#icon-icon_edit"></use>
        </svg>
    </div>
    <div class="edit-box ">

        <div class="swiper-container2">

            <div class="swiper-wrapper">
                <!-- <div class="swiper-slide"><img src="../0.jpg" alt=""></div>
                        sfsadf
                        <div class="swiper-slide"><img src="../1.png" alt=""></div>
                            <div class="swiper-slide"><img src="../2.gif" alt=""></div>
                            <div class="swiper-slide"><img src="../3.jpg" alt=""></div>
                            <div class="swiper-slide"><img src="../4.jpg" alt=""></div>
                            <div class="swiper-slide"><img src="../5.jpeg" alt=""></div> -->
            </div>
        </div>

        <div class="swiper-container1">
            <div class="swiper-wrapper">
                <!-- <div class="swiper-slide"><img src="../0.jpg" alt=""></div>
                        <div class="swiper-slide"><img src="../1.png" alt=""></div>
                        <div class="swiper-slide"><img src="../2.gif" alt=""></div>
                        <div class="swiper-slide"><img src="../3.jpg" alt=""></div>
                        <div class="swiper-slide"><img src="../4.jpg" alt=""></div>
                        <div class="swiper-slide"><img src="../5.jpeg" alt=""></div> -->
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>

        <input type="text" placeholder="昵称" class="playerNameInput">
        <textarea class="textarea" name="" id="" cols="30" rows="10" placeholder="卡片内容"></textarea>
        <div class="edit-btn-box">

            <div class="edit-confirm-btn">
                确定
            </div>

            <div class="edit-cancel-btn">
                取消
            </div>
        </div>
    </div>
    <div class="content">

        <div class="success-alert">
            发布消息卡片成功🐻
        </div>
        <div class="error-alert">
            发送消息卡片失败，请稍后再试一试🙊
        </div>


    </div>

</body>
<script src="//at.alicdn.com/t/font_1536199_uoqh5fg945.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/Swiper/8.0.6/swiper-bundle.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.26.0/axios.js"></script>
<script>

    let content = document.querySelector(".content");
    let addBtnBox = document.querySelector('.addBtn-box');
    let editBox = document.querySelector('.edit-box');
    let swiperBox = document.querySelector('.swiper-container1 .swiper-wrapper');
    let swiperBox2 = document.querySelector('.swiper-container2 .swiper-wrapper');
    let confirmBtn = document.querySelector(".edit-confirm-btn");
    let cancelBtn = document.querySelector(".edit-cancel-btn");
    let playerNameInput = document.querySelector(".playerNameInput");
    let textarea = document.querySelector(".textarea");
    let successalert = document.querySelector(".success-alert");
    let erroralert = document.querySelector(".error-alert");
    var num0 = 0, num1 = 0, num2 = 0, num3 = 0, num4 = 0, num5 = 0;
    let bodyWidth = document.body.clientWidth;


    //开局一个ajax请求，请求cards
    getCards();

    //开局获取浏览器页面宽度
    console.log(getCardCount(bodyWidth));



    // 为addBtnBox添加点击animation动画类名
    addBtnBox.onclick = function () {
        //清除表单
        playerNameInput.value = '';
        textarea.value = '';
        editBox.style.display = 'inline-block';
        editBox.className = 'edit-box animated bounceInRight delay-0.5s';
        this.className += ' addBtnBoxAni';

        let mySwiper = new Swiper('.swiper-container2', {
            thumbs: {
                swiper: {
                    // loop: true,
                    el: '.swiper-container1 ', //注意此处的设置方式
                    slidesPerView: 3,
                    // 如果需要前进后退按钮
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                }
            }
        });
    }

    //循环icon然后列表渲染至轮播中
    for (let i = 0; i < 48; i++) {
        var swiperSlide = document.createElement("div");
        swiperSlide.className = 'swiper-slide'
        swiperSlide.innerHTML = `<div class='icon-border'><svg class='edit-icon' aria-hidden='true'>
                                    <use xlink:href='#icon-${i}'></use>
                                </svg></div>`
        swiperBox.append(swiperSlide);
    }

    // 循环结束后抓取iconborder
    let iconBorder = document.querySelectorAll('.icon-border');
    let currIndex = 0;
    iconBorder[currIndex].style.border = '1.5px solid';
    iconBorder.forEach((item, index) => {
        item.onclick = function () {
            // if (currIndex !== null) {
            iconBorder[currIndex].style.border = 'none';
            iconBorder[currIndex].className = 'icon-border';
            // }
            this.className += ' animated rubberBand';
            setTimeout(() => {
                this.style.border = '1.5px solid';
            }, 500);
            currIndex = index;
        }
    })

    // 表单按钮
    confirmBtn.onclick = function () {
        confirmBtn.className += ' animated jello'
        if (!playerNameInput.value) {
            playerNameInput.className += ' animated bounce'
        } else if (!textarea.value) {
            textarea.className += ' animated bounce'
        } else {
            editBox.className = 'edit-box  animated fadeOutRight'
            const obj = {
                iconIndex: currIndex,
                playerName: playerNameInput.value,
                textarea: textarea.value
            }
            // axios.post("http://localhost:3000/submit",obj);
            axios.post("/submit", obj).then(value => {
                if (value.data.code) {
                    const _id = value.data._id;
                    axios.get(`/card?_id=${_id}`).then(value => {
                        const cardItem = value.data.data;
                        let card = document.createElement("div");
                        let playerName = document.createElement("span");
                        let textarea = document.createElement("div");
                        card.className = 'card';
                        playerName.className = 'palyerName';
                        textarea.className = 'card-content';
                        card.innerHTML = `<svg class="card-icon" aria-hidden="true">
                        <use xlink:href="#icon-${cardItem.iconIndex}"></use>
                        </svg>`
                        playerName.innerHTML = cardItem.playerName;
                        textarea.innerHTML = cardItem.textarea;

                        card.append(playerName);
                        card.append(textarea);
                        content.append(card);

                        const index = document.querySelectorAll(".card").length - 1;


                        setPosition(card, index);
                        // let remainder = index % 6;

                        // card.style.left = remainder * 270 + 'px';
                        // card.style.top = window[`num${remainder}`] + 20 + 'px';
                        // window[`num${remainder}`] += card.clientHeight + 20;
                    })
                    successalert.style.display = 'inline-block';
                    successalert.className += ' animated fadeInDown';
                    setTimeout(() => {
                        successalert.className = 'success-alert';
                        successalert.style.display = 'none';
                    }, 2500);
                } else {
                    erroralert.style.display = 'inline-block';
                    erroralert.className += ' animated fadeInDown';
                    setTimeout(() => {
                        erroralert.className = 'error-alert';
                        erroralert.style.display = 'none';
                    }, 2500);
                }

            })


        }


    }
    cancelBtn.onclick = function () {
        editBox.className = 'edit-box  animated fadeOutRight'
        // editBox.addEventListener('animationend', function() { 
        setTimeout(() => {
            editBox.style.display = 'none';
            editBox.className = 'edit-box';
        }, 500);

        //  })
    }



    // 动效元素的回调函数设置
    confirmBtn.addEventListener('animationend', function () {
        confirmBtn.className = 'edit-confirm-btn'
    })

    playerNameInput.addEventListener('animationend', function () {
        playerNameInput.className = 'playerNameInput'
    })

    textarea.addEventListener('animationend', function () {
        textarea.className = 'textarea'
    })

    editBox.addEventListener('animationend', function () {
        textarea.className = 'editBox'
    })

    //请求卡片函数
    function getCards() {
        axios.get("/cards").then(value => {
            const cards = value.data.data;
            if (value.data.code) {
                //请求成功
                cards.forEach((item, index) => {

                    //渲染页面所有初始卡片
                    let card = document.createElement("div");
                    let playerName = document.createElement("span");
                    let textarea = document.createElement("div");
                    card.className = 'card';
                    playerName.className = 'palyerName';
                    textarea.className = 'card-content';
                    card.innerHTML = `<svg class="card-icon" aria-hidden="true">
                <use xlink:href="#icon-${item.iconIndex}"></use>
                </svg>`;
                    playerName.innerHTML = item.playerName;
                    textarea.innerHTML = item.textarea;

                    card.append(playerName);
                    card.append(textarea);
                    content.append(card);

                    setPosition(card, index);
                    // let remainder = index % 6;

                    // card.style.left = remainder * 270 + 20 + 'px';
                    // card.style.top = window[`num${remainder}`] + 20 + 'px';
                    // window[`num${remainder}`] += card.clientHeight + 20;
                })
            } else {
                //请求失败
            }
        })
    }

    //获取一行显示几个card函数
    function getCardCount(bodyWidth) {
        let cardCount;

        if (bodyWidth >= 1620) {
            cardCount = 6;
        } else if (bodyWidth < 1620 && bodyWidth >= 1370) {
            cardCount = 5;
        } else if (bodyWidth < 1370 && bodyWidth >= 1110) {
            cardCount = 4;
        } else if (bodyWidth < 1110 && bodyWidth >= 830) {
            cardCount = 3;
        } else if (bodyWidth < 830 && bodyWidth >= 565) {
            cardCount = 2;
        } else if (bodyWidth < 565) {
            cardCount = 1;
        }
        return cardCount;
    }

    //card绝对布局规划函数
    function setPosition(card, index) {
        //调用getCardCount函数
        let cardCount = getCardCount(document.body.clientWidth);
        let remainder = index % cardCount;

        card.style.left = remainder * 270 + 20 + 'px';
        card.style.top = window[`num${remainder}`] + 20 + 'px';
        window[`num${remainder}`] += card.clientHeight + 20;
    }

    //页面宽度改变执行card重新排列函数
    // function autoSetPostion(){
    //     window.onresize = function()
    // }

</script>

</html>
